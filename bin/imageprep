#!/usr/bin/env ruby

#                    _                     ______ _      _    
#    /\             | |                   |  ____(_)    | |   
#   /  \   _ __   __| |_ __ _____      __ | |__   _  ___| | __
#  / /\ \ | '_ \ / _` | '__/ _ \ \ /\ / / |  __| | |/ __| |/ /
# / ____ \| | | | (_| | | |  __/\ V  V /  | |____| | (__|   < 
#/_/    \_\_| |_|\__,_|_|  \___| \_/\_/   |______|_|\___|_|\_\

require 'rubygems'
require 'bundler/setup'
require 'yaml'
require 'pp'

require_relative '../lib/imageprep/imagemanips'
require_relative '../lib/imageprep/options'

opts = ImagePrep::Options.new(ARGV)

imgs_yaml = Array.new

opts.images_to_load.each { |imageFileName|
	puts "Processing #{imageFileName}"
	im = ImagePrep::ImageManips.new(imageFileName, opts.outDir)
	im.copyOriginal
	im.generateSized

	imgs_yaml.push(im.generateYamlMeta)
}

# Emit the octo-yaml
puts "---"
puts "layout: post"
puts "title: "
puts "date:"
puts "comments: false"
puts "categories:" 
puts "photographs:"

imgs_yaml.each { |yaml|
	metadata = YAML.load_file(yaml)
	puts "- url: http://media.eick.us/#{metadata["path"]}"
	puts "  headline: \"#{metadata["headline"]}\""
	puts "  caption: \"#{metadata["caption"]}\""
	puts "  date_time_original: #{metadata["dateTimeOriginal"]}"
	puts "  copyright: #{metadata["copyright"]}"
	puts "  city: #{metadata["city"]}"
	puts "  state: #{metadata["state"]}"
	puts "  country: #{metadata["country"]}"
	puts "  exposure_time: #{metadata["exposureTime"]}"
	puts "  focal_length: #{metadata["focalLength"]}"
	puts "  aperture: #{metadata["aperture"]}"
	puts "  iso: #{metadata["iso"]}"
	puts "  camera: #{metadata["camera"]}"
	puts "  markdown: ![#{metadata["headline"]}](http://media.eick.us/images/#{metadata["path"]})"
}
puts "---"

imgs_yaml.each { |yaml|
	metadata = YAML.load_file(yaml)
	puts "{% photo2 http://media.eick.us/images/#{metadata["path"]} \"#{metadata["headline"]}\" %}"
	puts
}